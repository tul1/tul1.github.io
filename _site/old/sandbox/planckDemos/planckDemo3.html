<html>
<head>
  <meta name="viewport" content="width=device-width">
  <title>Bots - Planck.js</title>
</head>

<body>

<script src="../../../js/planck.js-0.1.34/dist/planck-with-testbed.js"></script>
<script src="http://192.168.5.5:8000/socket.io/socket.io.js"></script>

<script>


var client = io.connect('http://192.168.5.5:8000');
var sensFloorPosition={'posX':0,'posZ':0};


var player = null;

planck.testbed('Collition', function(testbed) {
  var pl = planck, Vec2 = pl.Vec2, Math = pl.Math;
  var width = 16.00, height = 8.00;
  var BALL_R = 0.25;
  testbed.x = 0, testbed.y = 0;

  testbed.width = width * 1.2, testbed.height = height * 1.2;
  testbed.ratio = 100;
//  testbed.mouseForce = -30;
// pl.internal.Settings.velocityThreshold = 0;

  var world = pl.World({});

  var botFixDef = {
    friction: 0.1,
    restitution: 0.99,
    mass: 1,
    userData: 'bot'
  };
  var botBodyDef = {
    linearDamping: 0.1,
    angularDamping: 0.2
  };
  
  for(var i=0; i<6; i++){
    var bot = world.createDynamicBody(botBodyDef);
    bot.setBullet(true);
    var pos_y = (i%2)? BALL_R : 2*BALL_R;
    bot.setPosition({x: (i*2), y: pos_y});
    bot.createFixture(pl.Circle(BALL_R), botFixDef);
//    bot.setLinearVelocity(Vec2(-2.0, 0.0));
  }


  player = world.createDynamicBody({mass:0});
  player.setPosition({x: -width / 4, y: 0});
  player.createFixture(pl.Circle(BALL_R), {});
  //body.setLinearVelocity(Vec2(10.0, 0.0));

  world.on('post-solve', function(contact) {
    console.log('post-solve');

    var fA = contact.getFixtureA(), bA = fA.getBody();
    var fB = contact.getFixtureB(), bB = fB.getBody();
    var bot = fA.getUserData() == botFixDef.userData && bA || fB.getUserData() == botFixDef.userData && bB;
//    bot.setLinearVelocity(Vec2(0.0, 0.0))

  });

  return world;

});

var stepsData=[{x:0,y:0},{x:0,y:0}];
client.on('objects-update', function(objects){
   for (var i = 0; i < objects.length; i++) {
        sensFloorPosition = {'posX':(objects[i].x*2),'posZ':(objects[i].y)};
        // var fi = 2*Math.PI*Math.PI*objects[0].aV/180;
        // var xV = objects[0].mV*Math.cos(fi);
        // var yV = objects[0].mV*Math.sin(fi);
        // console.log(xV+'   '+yV);
//        player.setPosition({x: objects[0].x*2, y: objects[0].y});
        
        stepsData.push({x: objects[0].x*2, y: objects[0].y})
        var transformX=objects[0].x*2 - stepsData[stepsData.length-2].x;
        var transformY=objects[0].y - stepsData[stepsData.length-2].y;

//      player.setTransform(Vec2(transformX,transformY),0);

        console.log({x: objects[0].x*2, y: objects[0].y});
        player.setTransform(Vec2(transformX,transformY),1);
        player.setPosition({x: objects[0].x*2, y: objects[0].y});

//      console.log(objects);
    }
});


</script>


</body>

</html>