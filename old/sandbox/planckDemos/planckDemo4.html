<html>
<head>
  <meta name="viewport" content="width=device-width">
  <title>Random trajectory - Planck.js</title>
</head>

<body>

<script src="../../../js/planck.js-0.1.34/dist/planck-with-testbed.js"></script>
<script src="trajectory.js"></script>

<script>

var step=0,trajectoryCounter=0
var player = null;

planck.testbed('Collition', function(testbed) {
  var pl = planck, Vec2 = pl.Vec2, Math = pl.Math;
  var width = 16.00, height = 8.00;
  var BALL_R = 0.25;
  testbed.x = 0, testbed.y = 0;

  testbed.width = width * 1.2, testbed.height = height * 1.2;
  testbed.ratio = 100;

   var WorldDef={
    gravity : Vec2.zero(),
    allowSleep : false,
    warmStarting : true,
    continuousPhysics : true,
    subStepping : true,
    blockSolve : false,
    velocityIterations : 10,
    positionIterations : 5
  };
  var world = pl.World(WorldDef);

  var botFixDef = {
    friction: 100,
    restitution: 0.99,
    mass: 10,
    userData: 'bot'
  };
  var botBodyDef = {
    linearDamping: 0.1,
    angularDamping: 0.2
  };
  
  for(var i=0; i<6; i++){
    var bot = world.createDynamicBody(botBodyDef);
    bot.setBullet(true);
    var pos_y = (i%2)? BALL_R : -BALL_R;
    bot.setPosition({x: (i*2), y: pos_y});
    bot.createFixture(pl.Circle(BALL_R), botFixDef);
   // bot.setLinearVelocity(Vec2(0.50, 0.0));
  }


  player = world.createKinematicBody();
  player.setPosition({x: -width / 4, y: 0});
  player.createFixture(pl.Circle(BALL_R), {});

//  var trajectory=straightLine(12);

  world.on('post-solve', function(contact) {
    console.log('post-solve');

    var fA = contact.getFixtureA(), bA = fA.getBody();
    var fB = contact.getFixtureB(), bB = fB.getBody();
    var bot = fA.getUserData() == botFixDef.userData && bA || fB.getUserData() == botFixDef.userData && bB;
    //bot.setLinearVelocity(Vec2(0.0, 0.0))

  });


  testbed.step = function() {
    step++;
    if(trajectoryCounter == trajectory.length)
      trajectoryCounter = 0;
    if(step==2){
        player.setPosition(trajectory[trajectoryCounter++]);
        step=0;      
    }
  };

  return world;

});

function straightLine(points){
  var trajectory = [];
  for(var i=0.0; i<points; i++)
    trajectory.push({x: i, y:0.0});
  return trajectory;
}


</script>


</body>

</html>